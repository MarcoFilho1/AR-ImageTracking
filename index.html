
<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/dist/mindar-image.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>body{margin:0;overflow:hidden} a-scene{position:fixed;inset:0} #ui{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.6);color:#fff} #log{position:fixed;left:8px;right:8px;bottom:8px;background:rgba(0,0,0,.6);color:#0f0;font:12px monospace;padding:8px}</style>
</head>
<body>
  <div id="ui"><button id="startBtn" disabled>Start AR</button></div>
  <div id="log"></div>

  <a-scene
    mindar-image="imageTargetSrc: ./targets.mind; autoStart: false;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    embedded>
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane width="1" height="0.552" material="color: blue; opacity: .5; transparent: true"></a-plane>
    </a-entity>
  </a-scene>

  <script>
    const log = m => document.querySelector('#log').textContent += (typeof m==='string'?m:JSON.stringify(m))+"\n";
    const scene = document.querySelector('a-scene');
    const btn = document.getElementById('startBtn');

    // habilita o botão somente quando o componente existir
    scene.addEventListener('loaded', () => {
      const ready = !!scene.components['mindar-image'];
      if (!ready) { log('?? mindar-image não montou ainda'); return; }
      btn.disabled = false;
      log('? mindar-image pronto');
    });

    scene.addEventListener('arReady', ()=>log('? arReady'));
    scene.addEventListener('arError', e=>log('? arError: '+(e?.detail?.message||'')));

    btn.onclick = async () => {
      try {
        // garante que o arquivo existe (evita 404 silencioso)
        const head = await fetch('./targets.mind', {method:'HEAD'});
        if (!head.ok) { log(`? targets.mind não encontrado (${head.status})`); return; }

        // chama o start somente quando o componente existe
        await scene.components['mindar-image'].start();
        document.getElementById('ui').style.display='none';
        log('?? câmera iniciada');
      } catch (e) { log('? start error: '+e); }
    };
  </script>
</body>
</html>
